<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>History</title>
  <link rel="stylesheet" href="/static/retrieval/styles.css" />
</head>
<body data-effect="aurora">
  <div class="bg-grid"></div>
  <div class="bg-aurora"></div>
  <div class="bg-dots"></div>
  <canvas class="fx-canvas" id="fx-canvas"></canvas>
  <div class="page">
    <nav class="nav">
      <a class="logo" href="/">VisualSearch</a>
      <div class="nav-links">
        <a href="/search/">Search</a>
        <a href="/history/">History</a>
      </div>
      <div class="nav-auth">
        <span class="user">{{ user.username }}</span>
        <a class="btn ghost" href="/logout/">Logout</a>
      </div>
    </nav>

    <header class="hero compact">
      <div class="badge">History</div>
      <h1>Your past searches</h1>
      <p>Review previous queries and their top results.</p>
    </header>

    {% if not items %}
    <section class="panel">
      <div class="empty">No searches yet. Run your first query in Search.</div>
    </section>
    {% endif %}

    {% for entry in items %}
    <section class="panel history-panel">
      <div class="history-header">
        <div class="label">Query</div>
        <div class="history-actions">
          <div class="date">{{ entry.created_at|date:"Y-m-d H:i" }}</div>
          <form method="post" action="/history/delete/{{ entry.id }}/" onsubmit="return confirm('Delete this history record?');">
            {% csrf_token %}
            <button class="btn ghost danger" type="submit">Delete</button>
          </form>
        </div>
      </div>
      <div class="history-body">
        <img class="query-image" src="{{ entry.query_url }}" alt="query" />
        <div>
          <div class="mini-label">Top {{ entry.top_k }} results</div>
        </div>
      </div>
      <details class="history-toggle">
        <summary class="history-summary">Show results</summary>
        <div class="grid">
          {% for item in entry.results %}
          <div class="card">
            {% if item.image_url %}
            <img src="{{ item.image_url }}" alt="result" />
            {% else %}
            <div class="placeholder">No image</div>
            {% endif %}
            <div class="card-meta">
              <div class="rank">#{{ item.rank }}</div>
              <div class="score">{{ item.similarity|floatformat:4 }}</div>
              {% if item.caption %}
              <div class="caption">{{ item.caption }}</div>
              {% endif %}
              {% if item.url %}
              <a class="source" href="{{ item.url }}" target="_blank" rel="noreferrer">Source</a>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      </details>
    </section>
    {% endfor %}
  </div>
  <div class="fx-panel" id="fx-panel">
    <div class="fx-title">Background FX</div>
    <label class="fx-row">
      <span>Animation</span>
      <input id="fx-toggle" type="checkbox" checked />
    </label>
    <label class="fx-row">
      <span>Effect</span>
      <select id="fx-select">
        <option value="none">None</option>
        <option value="aurora">Aurora</option>
        <option value="grid">Grid</option>
        <option value="stars">Stars</option>
        <option value="particles">Particles</option>
        <option value="boids">Boids</option>
        <option value="sakura">Sakura</option>
      </select>
    </label>
  </div>
  <button class="fx-fab" id="fx-fab" type="button">FX</button>
  <script src="/static/retrieval/app.js"></script>
</body>
</html>
